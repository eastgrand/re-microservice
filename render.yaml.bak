services:
  - type: web
    name: nesto-mortgage-analytics
    env: python
    plan: starter
    buildCommand: >-
      echo "Starting build process with FORCED skip-training" && 
      chmod +x ./deploy_to_render.sh &&
      echo "This file indicates model training should be skipped during deployment" > .skip_training &&
      export SKIP_MODEL_TRAINING=true &&
      echo "âš¡ SKIP TRAINING ENABLED - Model training will be bypassed" &&
      ./deploy_to_render.sh
    startCommand: >-
    echo "Starting memory-optimized SHAP worker" &&
    python3 -c "import gc; gc.enable()" &&
    python3 -c "from shap_memory_fix import apply_all_patches; apply_all_patches()" &&
    python3 repair_stuck_jobs.py --force &&
    rq worker --burst shap-jobs --url $REDIS_URL
      - key: REDIS_HEALTH_CHECK_INTERVAL
        value: "30"
    envVars:
      - key: REDIS_URL
      - key: REDIS_HEALTH_CHECK_INTERVAL
        value: "30"
        value: rediss://default:AVnAAAIjcDEzZjMwMjdiYWI5MjA0NjY3YTQ4ZjRjZjZjNWZhNTdmM3AxMA@ruling-stud-22976.upstash.io:6379
      - key: API_KEY
        sync: false  # This indicates that the value is secret and should be set in the Render dashboard